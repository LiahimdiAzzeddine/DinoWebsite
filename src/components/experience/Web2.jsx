/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
Command: npx gltfjsx@6.5.3 ./public/models/Web2.glb 
*/

import React, { useContext, useLayoutEffect, useMemo, useRef } from "react";
import { useGraph } from "@react-three/fiber";
import { useGLTF, PerspectiveCamera, useAnimations } from "@react-three/drei";
import { SkeletonUtils } from "three-stdlib";
import gsap from "gsap";
import { ScrollTrigger } from "gsap/ScrollTrigger";
import * as THREE from "three";
import { AnimationContext } from "./AnimationContext";

gsap.registerPlugin(ScrollTrigger);
export function Web2({ isActive, ...props }) {
  const group = useRef();
  const { scene, animations } = useGLTF("./models/Web2.glb");

  const clone = useMemo(() => SkeletonUtils.clone(scene), [scene]);
  const { nodes, materials } = useGraph(clone);
  const { actions, mixer } = useAnimations(animations, group);

  const { currentModel, isTransitioning } = useContext(AnimationContext);

  const Animations = [
    "Armature.001Action.001",
    "ArmatureAction",
    "Circle.001Action",
    "Cube.011Action.002",
    "Empty.006Action",
    "EmptyAction",
    "HandMover",
    "Sphere.005Action",
    "Sphere.006Action",
    "SphereAction.002",
  ];

  const smoothAnimations = [
    "Sphere.001Action.001",
    "Sphere.014Action.002",
    "CameraAction",
  ];

  useLayoutEffect(() => {
    if (!isActive || !actions || !mixer || isTransitioning) return;

    console.log("ðŸš€ Web2 Activated with currentModel:", currentModel);

    // Reset & Play regular animations
    Animations.forEach((name) => {
      const action = actions[name];
      if (action) {
        action.reset();
        action.paused = false;
        action.play();
      }
    });

    // Reset & Play smooth animations with slower speed
    smoothAnimations.forEach((name) => {
      const action = actions[name];
      if (action) {
        action.reset();
        action.setEffectiveTimeScale(0.2);
        action.paused = false;
        action.play();
      }
    });

    // Play camera entrance animation
    const cameraStart = actions["ActionEnter"];
    if (cameraStart) {
      cameraStart.reset();
      cameraStart.setLoop(THREE.LoopOnce, 1);
      cameraStart.clampWhenFinished = true;
      cameraStart.paused = false;
      cameraStart.play();
      cameraStart.time = 0.01;
      mixer.update(0.01);
    }

    return () => {
      // Optionally stop/reset animations when deactivated
      [...Animations, ...smoothAnimations].forEach((name) => {
        const action = actions[name];
        if (action) {
          action.stop();
          action.reset();
        }
      });
    };
  }, [isActive, actions, mixer, isTransitioning]);


  return (
      <group ref={group} {...props} dispose={null} visible={isActive}>
      <group name="Scene">
        <group
          name="Empty"
          position={[0.285, 5.921, -8.176]}
          rotation={[Math.PI / 2, 0, Math.PI / 2]}
        />
        <mesh
          name="Sphere014"
          castShadow
          receiveShadow
          geometry={nodes.Sphere014.geometry}
          material={nodes.Sphere014.material}
          position={[-3.668, 4.08, -2.876]}
          scale={[0.45, 0.767, 0.767]}
        />
        <mesh
          name="Sphere001"
          castShadow
          receiveShadow
          geometry={nodes.Sphere001.geometry}
          material={nodes.Sphere001.material}
          position={[-3.668, 12.438, 2.018]}
          rotation={[Math.PI, 0, Math.PI]}
          scale={[0.45, 0.767, 0.767]}
        />
        <group name="Empty001" position={[23.142, 20.042, -2.994]} scale={0.15}>
        
                <PerspectiveCamera
            name="Camera"
            makeDefault={isActive}
            far={1000}
            near={0.1}
            fov={16.696}
            position={[0, -0.094, 0.533]}
            rotation={[0, Math.PI / 2, 0]}
            scale={6.678}
          />
             
        
        </group>
        <mesh
          name="Object0012"
          castShadow
          receiveShadow
          geometry={nodes.Object0012.geometry}
          material={materials.lol_emoji}
          position={[0.387, 1.934, -3.188]}
          rotation={[1.534, -0.134, -1.228]}
          scale={0.153}>
          <mesh
            name="Object002"
            castShadow
            receiveShadow
            geometry={nodes.Object002.geometry}
            material={materials['Material.004']}
            position={[-13.026, 2.521, 4.18]}
          />
        </mesh>
        <mesh
          name="Sphere002"
          castShadow
          receiveShadow
          geometry={nodes.Sphere002.geometry}
          material={materials['Material.001']}
          position={[0.243, 4.012, 2.094]}
          rotation={[-2.071, 1.165, 2.27]}
          scale={0.68}>
          <mesh
            name="Eyes_Cube002"
            castShadow
            receiveShadow
            geometry={nodes.Eyes_Cube002.geometry}
            material={materials.Eye_Lid}
            position={[-0.001, 0.012, 0.002]}
            rotation={[Math.PI / 2, 0, 0]}
            scale={0.43}
          />
          <group
            name="glasss2"
            position={[-0.011, -0.031, 1.071]}
            rotation={[1.6, -0.004, -0.043]}
            scale={0.241}>
            <mesh
              name="Mesh006"
              castShadow
              receiveShadow
              geometry={nodes.Mesh006.geometry}
              material={materials.glass_mat}
            />
            <mesh
              name="Mesh006_1"
              castShadow
              receiveShadow
              geometry={nodes.Mesh006_1.geometry}
              material={materials.Glass_shader_out}
            />
          </group>
          <mesh
            name="Lash_Cube002"
            castShadow
            receiveShadow
            geometry={nodes.Lash_Cube002.geometry}
            material={materials.Eye_Lid}
            position={[-0.001, 0.012, 0.03]}
            rotation={[Math.PI / 2, 0, 0]}
            scale={0.43}
          />
          <mesh
            name="Mouth_Cube002"
            castShadow
            receiveShadow
            geometry={nodes.Mouth_Cube002.geometry}
            material={materials.Eye_Lid}
            position={[-0.001, -0.532, 0.853]}
            rotation={[Math.PI / 2, 0, 0]}
            scale={0.43}
          />
        </mesh>
        <group name="Empty003" position={[1.353, 0.015, 1.562]} rotation={[-0.004, 0.24, 0.031]}>
          <mesh
            name="Sphere"
            castShadow
            receiveShadow
            geometry={nodes.Sphere.geometry}
            material={materials['Material.001']}
            position={[-0.73, -0.184, 0.228]}
            rotation={[-2.222, 1.191, 2.225]}
            scale={0.799}>
            <mesh
              name="Eyes_Cube001"
              castShadow
              receiveShadow
              geometry={nodes.Eyes_Cube001.geometry}
              material={materials.Eye_Lid}
              position={[-0.001, 0.012, 0.002]}
              rotation={[Math.PI / 2, 0, 0]}
              scale={0.43}
            />
            <mesh
              name="heart-02_Cube001"
              castShadow
              receiveShadow
              geometry={nodes['heart-02_Cube001'].geometry}
              material={materials['Material.003']}
              position={[0.793, 0.831, 0.79]}
              rotation={[Math.PI / 2, 0, 0]}
              scale={0.356}
            />
            <mesh
              name="Heart-03_Cube001"
              castShadow
              receiveShadow
              geometry={nodes['Heart-03_Cube001'].geometry}
              material={materials['Material.003']}
              position={[0.802, -0.69, 0.947]}
              rotation={[Math.PI / 2, 0, 0]}
              scale={0.575}
            />
            <mesh
              name="Heart_01_Cube001"
              castShadow
              receiveShadow
              geometry={nodes.Heart_01_Cube001.geometry}
              material={materials['Material.003']}
              position={[-0.794, -0.603, 0.921]}
              rotation={[Math.PI / 2, 0, 0]}
              scale={0.468}
            />
            <mesh
              name="Lash_Cube001"
              castShadow
              receiveShadow
              geometry={nodes.Lash_Cube001.geometry}
              material={materials.Eye_Lid}
              position={[-0.001, 0.012, 0.03]}
              rotation={[Math.PI / 2, 0, 0]}
              scale={0.43}
            />
            <mesh
              name="Mouth_Cube001"
              castShadow
              receiveShadow
              geometry={nodes.Mouth_Cube001.geometry}
              material={materials.Eye_Lid}
              position={[-0.001, -0.532, 0.853]}
              rotation={[Math.PI / 2, 0, 0]}
              scale={0.43}
            />
          </mesh>
        </group>
        <group
          name="Armature001"
          position={[-0.091, 0.84, -0.237]}
          rotation={[0.077, 1.536, -0.317]}
          scale={0.336}>
          <group name="Retopo_Sphere001">
            <skinnedMesh
              name="mesh001"
              geometry={nodes.mesh001.geometry}
              material={materials['Material.016']}
              skeleton={nodes.mesh001.skeleton}
            />
            <skinnedMesh
              name="mesh001_1"
              geometry={nodes.mesh001_1.geometry}
              material={materials.pants}
              skeleton={nodes.mesh001_1.skeleton}
            />
            <skinnedMesh
              name="mesh001_2"
              geometry={nodes.mesh001_2.geometry}
              material={materials.skin}
              skeleton={nodes.mesh001_2.skeleton}
            />
          </group>
          <primitive object={nodes.Bone} />
          <primitive object={nodes.Bone007} />
          <primitive object={nodes.Bone008} />
        </group>
        <group
          name="Empty005"
          position={[0.004, 1.693, -0.583]}
          rotation={[1.087, 1.527, -0.387]}
          scale={1.047}>
          <group
            name="Trophy"
            position={[0.357, -0.012, 0.013]}
            rotation={[1.425, -1.328, 1.432]}
            scale={0.955}>
            <mesh
              name="Cylinder009"
              castShadow
              receiveShadow
              geometry={nodes.Cylinder009.geometry}
              material={materials.M_Tropy}
            />
            <mesh
              name="Cylinder009_1"
              castShadow
              receiveShadow
              geometry={nodes.Cylinder009_1.geometry}
              material={materials['Material.008']}
            />
            <mesh
              name="Cylinder009_2"
              castShadow
              receiveShadow
              geometry={nodes.Cylinder009_2.geometry}
              material={materials.Material}
            />
          </group>
        </group>
        <group
          name="Empty006"
          position={[-0.072, 1.82, 0.182]}
          rotation={[0.776, 1.515, 0.002]}
          scale={0.268}>
          <group
            name="Armature"
            position={[0.239, 0.054, 0.33]}
            rotation={[1.601, 0.618, 1.507]}
            scale={3.568}>
            <skinnedMesh
              name="Cube"
              geometry={nodes.Cube.geometry}
              material={materials.Blackk}
              skeleton={nodes.Cube.skeleton}
            />
            <primitive object={nodes.Bone_1} />
          </group>
          <mesh
            name="Cube001"
            castShadow
            receiveShadow
            geometry={nodes.Cube001.geometry}
            material={materials.skin}
            position={[-0.12, -0.118, 0.312]}
            rotation={[-1.58, 0.644, 1.602]}
            scale={3.568}
          />
          <mesh
            name="Cube008"
            castShadow
            receiveShadow
            geometry={nodes.Cube008.geometry}
            material={materials.skin}
            position={[0.136, -0.126, 0.306]}
            rotation={[1.611, 1.033, -1.617]}
            scale={3.568}
          />
          <group
            name="Cube011"
            position={[0.321, 0.089, 0.383]}
            rotation={[1.581, 0.176, -1.628]}
            scale={[0.076, 2.381, 0.076]}>
            <mesh
              name="Cube019"
              castShadow
              receiveShadow
              geometry={nodes.Cube019.geometry}
              material={materials.Blackk}
            />
            <mesh
              name="Cube019_1"
              castShadow
              receiveShadow
              geometry={nodes.Cube019_1.geometry}
              material={materials['Material.008']}
            />
          </group>
        </group>
      </group>
    </group>
  );
}

useGLTF.preload("./models/Web2.glb");
